{% extends "medidores/base_medidores.html" %}

{% block title %}Confirmar cambio de estado{% endblock %}

{% block content %}

<div class="min-h-[60vh] flex items-center justify-center">
    <div class="w-full max-w-xl">

        <!-- Card principal -->
        <div class="bg-base-100 rounded-2xl shadow-2xl border border-base-300 overflow-hidden">

            <!-- Encabezado -->
            <div class="px-6 py-4 bg-base-200 border-b border-base-300 flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-info/10 flex items-center justify-center text-info">
                    <i class="bi bi-arrow-repeat text-xl"></i>
                </div>
                <div>
                    <h1 class="text-lg sm:text-xl font-bold text-base-content">
                        Cambiar estado del medidor
                    </h1>
                    <p class="text-xs text-base-content/60">
                        Actualiza el estado operativo del dispositivo
                    </p>
                </div>
            </div>

            <!-- Contenido -->
            <div class="px-6 py-6 space-y-6 text-sm sm:text-base">

                <!-- Información del medidor -->
                <div class="bg-base-200/70 rounded-xl p-4 border border-base-300">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <p class="text-xs font-semibold uppercase tracking-wide text-base-content/60">
                                Código serial
                            </p>
                            <p class="font-mono font-semibold text-base-content">
                                {{ medidor.codigo_serial }}
                            </p>
                        </div>

                        <div>
                            <p class="text-xs font-semibold uppercase tracking-wide text-base-content/60">
                                Estado actual
                            </p>
                            {% if medidor.estado == 'activo' %}
                                <span class="badge badge-success gap-1 text-xs text-white">
                                    <i class="bi bi-check-circle-fill"></i>
                                    {{ medidor.get_estado_display }}
                                </span>
                            {% elif medidor.estado == 'mantenimiento' %}
                                <span class="badge badge-warning gap-1 text-xs">
                                    <i class="bi bi-tools"></i>
                                    {{ medidor.get_estado_display }}
                                </span>
                            {% elif medidor.estado == 'danado' %}
                                <span class="badge badge-error gap-1 text-xs text-white">
                                    <i class="bi bi-exclamation-octagon"></i>
                                    {{ medidor.get_estado_display }}
                                </span>
                            {% else %}
                                <span class="badge badge-ghost gap-1 text-xs">
                                    <i class="bi bi-dash-circle"></i>
                                    {{ medidor.get_estado_display }}
                                </span>
                            {% endif %}
                        </div>
                    </div>

                    {% if medidor.usuario %}
                    <div class="mt-3 pt-3 border-t border-base-300">
                        <p class="text-xs font-semibold uppercase tracking-wide text-base-content/60">
                            Usuario asociado
                        </p>
                        <p class="text-sm font-medium text-base-content">
                            {{ medidor.usuario.nombre }}
                        </p>
                        <p class="text-xs font-mono text-base-content/60">
                            {{ medidor.usuario.rut }}
                        </p>
                    </div>
                    {% endif %}
                </div>

                <!-- Formulario -->
                <form method="post" class="space-y-4">
                    {% csrf_token %}

                    <div class="form-control w-full">
                        <label for="nuevo_estado" class="label">
                            <span class="label-text font-semibold">
                                Nuevo estado del medidor
                            </span>
                        </label>
                        <select
                            name="nuevo_estado"
                            id="nuevo_estado"
                            class="select select-bordered w-full text-sm
                                   bg-base-100 text-base-content
                                   focus:outline-none focus:select-info"
                        >
                            {% for estado, label in estados %}
                            <option value="{{ estado }}" {% if medidor.estado == estado %}selected{% endif %}>
                                {{ label }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Nota informativa -->
                    <div class="flex items-start gap-3 bg-info/10 border border-info/30 text-info rounded-xl px-4 py-3">
                        <i class="bi bi-info-circle-fill mt-0.5 text-lg"></i>
                        <p class="text-xs sm:text-sm">
                            Cambiar el estado puede afectar reportes, lecturas y disponibilidad del medidor.
                            Asegúrate de seleccionar el estado correcto según la situación actual del dispositivo.
                        </p>
                    </div>

                    <!-- Acciones -->
                    <div class="flex flex-col-reverse sm:flex-row gap-3 pt-2 sm:justify-end">
                        <a href="{% url 'medidores:historial_medidores' %}"
                           class="btn btn-ghost w-full sm:w-auto gap-2">
                            <i class="bi bi-arrow-left"></i>
                            Cancelar
                        </a>

                        <button type="submit"
                                class="btn btn-primary text-white w-full sm:w-auto gap-2 shadow-md">
                            <i class="bi bi-check-lg"></i>
                            Confirmar cambio
                        </button>
                    </div>
                </form>

            </div>
        </div>

    </div>
</div>

{% endblock %}
